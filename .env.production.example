# =============================================================================
#  Vizora Digital Signage Platform — Production Environment Configuration
# =============================================================================
#
#  SETUP INSTRUCTIONS
#  ------------------
#  1. Copy this file to .env in the project root:
#        cp .env.production.example .env
#
#  2. Generate all secrets (run each command and paste the output):
#        openssl rand -hex 32    # for JWT_SECRET
#        openssl rand -hex 32    # for DEVICE_JWT_SECRET
#        openssl rand -hex 32    # for METRICS_TOKEN
#        openssl rand -hex 24    # for POSTGRES_PASSWORD
#        openssl rand -hex 24    # for REDIS_PASSWORD
#        openssl rand -hex 24    # for MINIO_SECRET_KEY
#        openssl rand -hex 24    # for MONGO_INITDB_ROOT_PASSWORD
#        openssl rand -hex 24    # for GF_SECURITY_ADMIN_PASSWORD
#
#  3. Replace ALL placeholder values (search for "CHANGEME" and "your-")
#
#  4. Start infrastructure:
#        docker-compose -f docker/docker-compose.yml up -d
#
#  5. Run database migrations:
#        pnpm --filter @vizora/database db:generate
#        pnpm --filter @vizora/database db:migrate
#
#  6. Start application services:
#        pm2 start ecosystem.config.js --env production
#
#  SECURITY NOTES
#  --------------
#  - NEVER commit this file with real credentials to version control.
#  - The .env file is gitignored by default; keep it that way.
#  - Rotate all secrets on a regular schedule (quarterly recommended).
#  - Use a secrets manager (Vault, AWS Secrets Manager) in production if possible.
#
# =============================================================================


# =============================================================================
# Node Environment
# =============================================================================
# Required. Must be "production" for production deployments.
NODE_ENV=production


# =============================================================================
# Service Ports — FIXED ASSIGNMENTS (DO NOT CHANGE)
# =============================================================================
# Middleware API, Web Dashboard, and Realtime Gateway validate their port at
# startup and will exit immediately if the assigned port is unavailable.
PORT=3000
MIDDLEWARE_PORT=3000
WEB_PORT=3001
REALTIME_PORT=3002


# =============================================================================
# PostgreSQL Database
# =============================================================================
# Required. The primary data store for all application data (via Prisma ORM).
#
# Production connection string includes:
#   connection_limit=10  — max connections in the pool (keep low for stability)
#   pool_timeout=20      — seconds to wait for a free connection before erroring
#   statement_timeout=30000 — milliseconds before a query is killed (30s)
#
# Use the POSTGRES_PASSWORD you set in the Docker section below.
DATABASE_URL=postgresql://postgres:CHANGEME_POSTGRES_PASSWORD@localhost:5432/vizora?connection_limit=10&pool_timeout=20&statement_timeout=30000

# Optional. Used by scripts that need a connection string without pool params.
POSTGRES_URL=postgresql://postgres:CHANGEME_POSTGRES_PASSWORD@localhost:5432/vizora


# =============================================================================
# MongoDB (Analytics & Time-Series Data)
# =============================================================================
# Required. Stores analytics events, device telemetry, and time-series data.
# Use the MONGO credentials you set in the Docker section below.
MONGODB_URL=mongodb://mongoadmin:CHANGEME_MONGO_PASSWORD@localhost:27017/vizora?authSource=admin


# =============================================================================
# Redis (Caching & Real-Time Device State)
# =============================================================================
# Required. Used for device online/offline status (fast reads), session caching,
# rate-limiting counters, and pub/sub between middleware and realtime services.
# Use the REDIS_PASSWORD you set in the Docker section below.
REDIS_URL=redis://:CHANGEME_REDIS_PASSWORD@localhost:6379
REDIS_PASSWORD=CHANGEME_REDIS_PASSWORD


# =============================================================================
# JWT Authentication
# =============================================================================
# Required. Two separate secrets for user and device authentication.
# IMPORTANT: Each secret must be at least 32 characters. Generate with:
#   openssl rand -hex 32
#
# The user JWT and device JWT use separate secrets so that compromising one
# does not compromise the other.

# User authentication (dashboard login, API access)
JWT_SECRET=CHANGEME_GENERATE_WITH_openssl_rand_hex_32
JWT_EXPIRES_IN=7d

# Device authentication (display screen registration, WebSocket handshake)
DEVICE_JWT_SECRET=CHANGEME_GENERATE_WITH_openssl_rand_hex_32

# Bcrypt hash rounds for password hashing. Higher = more secure but slower.
# 14 is a good production default (~1s per hash). Do not go below 12.
BCRYPT_ROUNDS=14


# =============================================================================
# Service URLs — Public & Internal
# =============================================================================
# Required. API_BASE_URL is the publicly reachable URL of the middleware API.
# Used by content controllers to generate download URLs and by the realtime
# gateway to reach the middleware. The app will throw at startup in production
# if this is not set.
API_BASE_URL=https://api.your-domain.com

# Required. The public URL of the web dashboard. Used by the pairing service
# to generate device pairing QR code links.
WEB_URL=https://app.your-domain.com

# Required. Internal URL the realtime gateway and middleware use to communicate
# with each other. If all services run on the same host, use localhost.
REALTIME_URL=http://localhost:3002

# CORS — comma-separated list of allowed origins for API and WebSocket requests.
# Must include at least the web dashboard URL.
CORS_ORIGIN=https://app.your-domain.com


# =============================================================================
# MinIO / S3 Object Storage
# =============================================================================
# Required. Stores uploaded content files (images, videos, HTML bundles).
# In production, MINIO_USE_SSL should be true if MinIO is behind TLS.
MINIO_ENDPOINT=localhost
MINIO_PORT=9000
MINIO_ACCESS_KEY=CHANGEME_MINIO_ACCESS_KEY
MINIO_SECRET_KEY=CHANGEME_MINIO_SECRET_KEY
MINIO_BUCKET=vizora-assets
MINIO_USE_SSL=true


# =============================================================================
# Frontend — Build-Time Variables (baked into the client-side JS bundle)
# =============================================================================
# Required. These NEXT_PUBLIC_ variables are embedded at build time by Next.js
# and cannot be changed at runtime. Rebuild the web service after any change.

# The public URL of the middleware API, as seen by the user's browser.
NEXT_PUBLIC_API_URL=https://api.your-domain.com/api

# The public URL of the realtime WebSocket gateway, as seen by the user's browser.
NEXT_PUBLIC_SOCKET_URL=https://ws.your-domain.com

# Internal URL used by Next.js server-side rendering (rewrites/proxies).
# This does NOT need to be publicly reachable — it can use localhost.
BACKEND_URL=http://localhost:3000


# =============================================================================
# Monitoring — Sentry Error Tracking
# =============================================================================
# Optional. If SENTRY_DSN is not set, error tracking is disabled gracefully.
# Both middleware and realtime services support Sentry independently.

# Sentry Data Source Name (get this from your Sentry project settings)
# SENTRY_DSN=https://your-key@sentry.io/your-project-id

# Tag errors with a release version for tracking regressions across deploys.
# SENTRY_RELEASE=vizora@1.0.0

# Realtime service supports additional Sentry tuning:
# SENTRY_TRACES_SAMPLE_RATE=0.1
# SENTRY_PROFILES_SAMPLE_RATE=0.1


# =============================================================================
# Monitoring — Prometheus Metrics
# =============================================================================
# Optional. The realtime gateway exposes a /metrics endpoint for Prometheus.
# In production, requests to /metrics must include a valid Bearer token matching
# this value. If not set, the endpoint is unprotected (only allowed in non-prod).
# METRICS_TOKEN=CHANGEME_GENERATE_WITH_openssl_rand_hex_32


# =============================================================================
# Logging
# =============================================================================
# Optional. Controls the verbosity of application logs. Defaults to "info".
# Options: error, warn, info, debug
LOG_LEVEL=info


# =============================================================================
# Docker Infrastructure Credentials
# =============================================================================
# These are read by docker-compose.yml to configure the backing services.
# They MUST match the credentials used in DATABASE_URL, MONGODB_URL, and
# REDIS_URL above — if you change one, change both.

# PostgreSQL
POSTGRES_PASSWORD=CHANGEME_POSTGRES_PASSWORD

# MongoDB
MONGO_INITDB_ROOT_USERNAME=mongoadmin
MONGO_INITDB_ROOT_PASSWORD=CHANGEME_MONGO_PASSWORD

# Redis (must match the password in REDIS_URL and REDIS_PASSWORD above)
# Already defined above in the Redis section.

# MinIO (root credentials for the admin console at :9001)
MINIO_ROOT_USER=CHANGEME_MINIO_ACCESS_KEY
MINIO_ROOT_PASSWORD=CHANGEME_MINIO_SECRET_KEY

# Grafana (admin UI at :3003)
GF_SECURITY_ADMIN_PASSWORD=CHANGEME_GRAFANA_PASSWORD


# =============================================================================
# Backups
# =============================================================================
# Optional. Used by backup scripts (if configured) for automated database dumps.
BACKUP_DIR=/var/backups/vizora
BACKUP_RETENTION_DAYS=7


# =============================================================================
# Billing (Optional — enable if using Stripe/Razorpay integration)
# =============================================================================
# These are only needed if the billing module is active.
# STRIPE_BASIC_MONTHLY_PRICE_ID=price_xxx
# STRIPE_BASIC_YEARLY_PRICE_ID=price_xxx
# STRIPE_PRO_MONTHLY_PRICE_ID=price_xxx
# STRIPE_PRO_YEARLY_PRICE_ID=price_xxx
# RAZORPAY_BASIC_PLAN_ID=plan_xxx
# RAZORPAY_PRO_PLAN_ID=plan_xxx
