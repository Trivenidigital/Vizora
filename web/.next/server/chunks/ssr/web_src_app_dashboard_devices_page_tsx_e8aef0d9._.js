module.exports=[58894,a=>{"use strict";var b=a.i(64239),c=a.i(872),d=a.i(59665),e=a.i(79412),f=a.i(31893),g=a.i(61027),h=a.i(51355),i=a.i(60547),j=a.i(16569),k=a.i(21113);let l={online:{color:"text-green-600 dark:text-green-400",bgColor:"bg-green-100 dark:bg-green-900",dotColor:"bg-green-500",label:"Online",icon:"check"},offline:{color:"text-red-600 dark:text-red-400",bgColor:"bg-red-100 dark:bg-red-900",dotColor:"bg-red-500",label:"Offline",icon:"x"},idle:{color:"text-yellow-600 dark:text-yellow-400",bgColor:"bg-yellow-100 dark:bg-yellow-900",dotColor:"bg-yellow-500",label:"Idle",icon:"pause"},error:{color:"text-orange-600 dark:text-orange-400",bgColor:"bg-orange-100 dark:bg-orange-900",dotColor:"bg-orange-500",label:"Error",icon:"alertTriangle"}};function m({deviceId:a,showLabel:d=!0,showTime:e=!1,className:f=""}){let{getDeviceStatus:g,subscribeToDevice:h}=(0,k.useDeviceStatus)(),[i,j]=(0,c.useState)("offline"),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)(!1);(0,c.useEffect)(()=>{let b=h(a,a=>{j(a.status),n(new Date(a.timestamp)),p(!0),setTimeout(()=>p(!1),600)}),c=g(a);return c&&(j(c.status),n(new Date(c.timestamp))),b},[a]);let q=l[i];return(0,b.jsxs)("div",{className:`flex items-center gap-2 ${f}`,children:[(0,b.jsxs)("div",{className:`relative w-3 h-3 rounded-full ${q.dotColor}`,children:["online"===i&&(0,b.jsx)("div",{className:`absolute inset-0 rounded-full ${q.dotColor} animate-pulse opacity-75`}),o&&(0,b.jsx)("div",{className:`absolute inset-0 rounded-full ${q.dotColor} animate-pulse`})]}),d&&(0,b.jsx)("div",{className:`px-2 py-1 rounded-md text-xs font-semibold ${q.bgColor} ${q.color}`,children:q.label}),e&&m&&(0,b.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400 ml-1",children:(()=>{if(!m)return"";let a=Math.floor((new Date().getTime()-m.getTime())/1e3),b=Math.floor(a/60),c=Math.floor(b/60);return a<60?`${a}s ago`:b<60?`${b}m ago`:c<24?`${c}h ago`:m.toLocaleDateString()})()})]})}var n=a.i(57052),o=a.i(38982);a.i(68997);var p=a.i(35660),q=a.i(59518),r=a.i(96336),s=a.i(31525);function t(){let a=(0,d.useRouter)(),k=(0,n.useToast)(),[l,t]=(0,c.useState)([]),[u,v]=(0,c.useState)([]),[w,x]=(0,c.useState)([{id:"group-1",name:"Store Locations",description:"All retail store displays",deviceIds:[]},{id:"group-2",name:"Corporate Office",description:"Main office lobby and conference rooms",deviceIds:[]},{id:"group-3",name:"Digital Kiosks",description:"Self-service kiosks",parentGroupId:void 0,deviceIds:[]}]),[y,z]=(0,c.useState)([]),[A,B]=(0,c.useState)(!0),[C,D]=(0,c.useState)(null),[E,F]=(0,c.useState)(!1),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)(""),[M,N]=(0,c.useState)({nickname:"",location:""}),[O,P]=(0,c.useState)(!1),[Q,R]=(0,c.useState)(""),S=(0,o.useDebounce)(Q,300),[T,U]=(0,c.useState)(null),[V,W]=(0,c.useState)("asc"),[X,Y]=(0,c.useState)(1),[Z,$]=(0,c.useState)(10),[_,aa]=(0,c.useState)(!1),[ab,ac]=(0,c.useState)("offline"),ad=(0,c.useCallback)(a=>{t(b=>b.map(b=>b.id===a.deviceId?{...b,status:a.status,lastSeen:a.lastSeen,currentPlaylistId:a.currentPlaylistId??b.currentPlaylistId}:b)),ac("connected"),console.log("[DevicesPage] Device status updated:",a)},[]),ae=(0,c.useCallback)(a=>{ac(a?"connected":"offline"),a&&k.info("Real-time connection established")},[k]),{isConnected:af,isOffline:ag,emitDeviceUpdate:ah}=(0,p.useRealtimeEvents)({enabled:!0,onDeviceStatusChange:ad,onConnectionChange:ae}),{updateOptimistic:ai,commitOptimistic:aj,rollbackOptimistic:ak,hasPendingUpdates:al}=(0,q.useOptimisticState)(l),{retry:am,recordError:an,clearError:ao}=(0,r.useErrorRecovery)({onError:a=>{"critical"===a.severity&&k.error(`Critical: ${a.error}`)},retryConfig:{maxAttempts:3,initialDelay:1e3}});(0,c.useEffect)(()=>{ap(),aq()},[]);let ap=async()=>{try{B(!0),await am("loadDevices",async()=>{let a=await e.apiClient.getDisplays(),b=a.data||a||[];return t(b),ao("loadDevices"),b},void 0,a=>{k.error("Failed to load devices: "+(a.message||"Unknown error"))})}catch(a){an("loadDevices",a,"warning")}finally{B(!1)}},aq=async()=>{try{let a=await e.apiClient.getPlaylists();v(a.data||a||[])}catch(a){}},ar=a=>{if(!a)return null;let b=u.find(b=>b.id===a);return b?.name||null},as=async()=>{if(C)try{P(!0);let a=`edit_${C.id}_${Date.now()}`;ai(a,a=>a.map(a=>a.id===C.id?{...a,nickname:M.nickname,location:M.location}:a)),await am(a,async()=>(await e.apiClient.updateDisplay(C.id,M),!0),()=>{aj(a),k.success("Device updated successfully"),F(!1),ah({deviceId:C.id,status:C.status,lastSeen:new Date().toISOString()})},b=>{ak(a),k.error("Failed to update device: "+(b.message||"Unknown error")),an(a,b,"warning")})}catch(a){k.error(a.message||"Failed to update device")}finally{P(!1)}},at=async()=>{if(C)try{P(!0);let a=`delete_${C.id}_${Date.now()}`,b=C.id;ai(a,a=>a.filter(a=>a.id!==b)),await am(a,async()=>(await e.apiClient.deleteDisplay(b),!0),()=>{aj(a),k.success("Device deleted successfully"),H(!1),D(null)},b=>{ak(a),k.error("Failed to delete device: "+(b.message||"Unknown error")),an(a,b,"warning")})}catch(a){k.error(a.message||"Failed to delete device")}finally{P(!1)}},au=async a=>{try{P(!0);let b=await e.apiClient.generatePairingToken(a.id);L(b.pairingCode||"N/A"),D(a),J(!0)}catch(a){k.error(a.message||"Failed to generate pairing code")}finally{P(!1)}},av=a=>{T===a?"asc"===V?W("desc"):U(null):(U(a),W("asc"))},aw=l.filter(a=>!S||a.nickname.toLowerCase().includes(S.toLowerCase())||a.location&&a.location.toLowerCase().includes(S.toLowerCase())).sort((a,b)=>{if(!T)return 0;let c=a[T],d=b[T];return null==c&&null==d?0:null==c?1:null==d?-1:c<d?"asc"===V?-1:1:c>d?"asc"===V?1:-1:0}),ax=aw.length,ay=Math.ceil(ax/Z),az=(X-1)*Z,aA=az+Z,aB=aw.slice(az,aA);(0,c.useEffect)(()=>{Y(1)},[S]);let aC=a=>T!==a?null:"asc"===V?" ↑":" ↓";return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(k.ToastContainer,{}),(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("h2",{className:"text-3xl font-bold text-gray-900 dark:text-gray-50",children:"Devices"}),(0,b.jsxs)("div",{className:`px-3 py-1 rounded-full text-xs font-semibold flex items-center gap-1 ${"connected"===ab?"bg-success-100 text-success-800 dark:bg-success-900 dark:text-success-200":"offline"===ab?"bg-warning-100 text-warning-800 dark:bg-warning-900 dark:text-warning-200":"bg-error-100 text-error-800 dark:bg-error-900 dark:text-error-200"}`,children:[(0,b.jsx)("span",{className:`h-2 w-2 rounded-full ${"connected"===ab?"bg-success-500":"offline"===ab?"bg-warning-500":"bg-error-500"}`}),"connected"===ab?"Live":"offline"===ab?"Offline":"Error"]})]}),(0,b.jsxs)("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:["Manage your paired display devices (",l.length," total)",al()&&" • Syncing changes..."]})]}),(0,b.jsxs)("button",{onClick:()=>a.push("/dashboard/devices/pair"),className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition font-semibold shadow-md hover:shadow-lg flex items-center gap-2",children:[(0,b.jsx)(s.Icon,{name:"add",size:"lg",className:"text-white"}),(0,b.jsx)("span",{children:"Pair New Device"})]})]}),(0,b.jsx)(j.default,{value:Q,onChange:R,placeholder:"Search devices by name or location..."}),A?(0,b.jsx)("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow p-12",children:(0,b.jsx)(h.default,{size:"lg"})}):0===l.length?(0,b.jsx)(i.default,{icon:"devices",title:"No devices yet",description:"Get started by pairing your first display device",action:{label:"Pair Device",onClick:()=>a.push("/dashboard/devices/pair")}}):(0,b.jsxs)(b.Fragment,{children:[S&&(0,b.jsx)("div",{className:"bg-info-50 dark:bg-info-900 border border-info-200 dark:border-info-700 rounded-lg p-3 mb-4",children:(0,b.jsxs)("p",{className:"text-sm text-info-800 dark:text-info-200",children:[aB.length," ",1===aB.length?"result":"results"," found"]})}),(0,b.jsx)("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow overflow-hidden",children:(0,b.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,b.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,b.jsxs)("tr",{children:[(0,b.jsxs)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 select-none",onClick:()=>av("nickname"),children:["Device",aC("nickname")]}),(0,b.jsxs)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 select-none",onClick:()=>av("status"),children:["Status",aC("status")]}),(0,b.jsxs)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 select-none",onClick:()=>av("location"),children:["Location",aC("location")]}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Currently Playing"}),(0,b.jsxs)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 select-none",onClick:()=>av("lastSeen"),children:["Last Seen",aC("lastSeen")]}),(0,b.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),(0,b.jsx)("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:aB.map(a=>(0,b.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800 transition",children:[(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)(s.Icon,{name:"devices",size:"xl",className:"mr-3 text-gray-600 dark:text-gray-400"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-50",children:a.nickname}),(0,b.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["ID: ",a.id]})]})]})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsx)(m,{deviceId:a.id,showLabel:!0,showTime:!0})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-400",children:a.location||"—"}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:ar(a.currentPlaylistId)?(0,b.jsxs)("span",{className:"px-3 py-1 bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 rounded-full text-xs font-semibold flex items-center gap-1 w-fit",children:[(0,b.jsx)(s.Icon,{name:"playlists",size:"sm",className:"text-primary-800 dark:text-primary-200"}),(0,b.jsx)("span",{children:ar(a.currentPlaylistId)})]}):(0,b.jsx)("span",{className:"text-gray-400 dark:text-gray-600 italic",children:"No playlist"})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:a.lastSeen?new Date(a.lastSeen).toLocaleString():"Never"}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)("button",{onClick:()=>{D(a),N({nickname:a.nickname,location:a.location||""}),F(!0)},className:"text-blue-600 hover:text-blue-800 hover:bg-blue-50 px-3 py-1 rounded transition font-medium",children:"Edit"}),(0,b.jsx)("button",{onClick:()=>au(a),className:"text-purple-600 hover:text-purple-800 hover:bg-purple-50 px-3 py-1 rounded transition font-medium",children:"Pair"}),(0,b.jsx)("button",{onClick:()=>{D(a),H(!0)},className:"text-red-600 hover:text-red-800 hover:bg-red-50 px-3 py-1 rounded transition font-medium",children:"Delete"})]})})]},a.id))})]})}),ax>0&&(0,b.jsxs)("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6 rounded-b-lg",children:[(0,b.jsxs)("div",{className:"flex-1 flex justify-between sm:hidden",children:[(0,b.jsx)("button",{onClick:()=>Y(a=>Math.max(1,a-1)),disabled:1===X,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),(0,b.jsx)("button",{onClick:()=>Y(a=>Math.min(ay,a+1)),disabled:X===ay,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),(0,b.jsxs)("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("p",{className:"text-sm text-gray-700",children:["Showing ",(0,b.jsx)("span",{className:"font-medium",children:az+1})," to"," ",(0,b.jsx)("span",{className:"font-medium",children:Math.min(aA,ax)})," of"," ",(0,b.jsx)("span",{className:"font-medium",children:ax})," devices"]}),(0,b.jsxs)("select",{value:Z,onChange:a=>{$(Number(a.target.value)),Y(1)},className:"text-sm border-gray-300 rounded-md",children:[(0,b.jsx)("option",{value:10,children:"10 per page"}),(0,b.jsx)("option",{value:25,children:"25 per page"}),(0,b.jsx)("option",{value:50,children:"50 per page"}),(0,b.jsx)("option",{value:100,children:"100 per page"})]})]}),(0,b.jsx)("div",{children:(0,b.jsxs)("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[(0,b.jsx)("button",{onClick:()=>Y(a=>Math.max(1,a-1)),disabled:1===X,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"← Previous"}),Array.from({length:Math.min(5,ay)},(a,c)=>{let d;return d=ay<=5||X<=3?c+1:X>=ay-2?ay-4+c:X-2+c,(0,b.jsx)("button",{onClick:()=>Y(d),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${X===d?"z-10 bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,children:d},d)}),(0,b.jsx)("button",{onClick:()=>Y(a=>Math.min(ay,a+1)),disabled:X===ay,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next →"})]})})]})]})]}),(0,b.jsx)(f.default,{isOpen:E,onClose:()=>F(!1),title:"Edit Device",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Device Nickname"}),(0,b.jsx)("input",{type:"text",value:M.nickname,onChange:a=>N({...M,nickname:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., Store Front Display"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Location (Optional)"}),(0,b.jsx)("input",{type:"text",value:M.location,onChange:a=>N({...M,location:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., Main Entrance"})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,b.jsx)("button",{onClick:()=>F(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition",disabled:O,children:"Cancel"}),(0,b.jsxs)("button",{onClick:as,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition disabled:opacity-50 flex items-center gap-2",disabled:O||!M.nickname.trim(),children:[O&&(0,b.jsx)(h.default,{size:"sm"}),"Save Changes"]})]})]})}),(0,b.jsx)(f.default,{isOpen:I,onClose:()=>J(!1),title:"Pairing Code",children:(0,b.jsxs)("div",{className:"text-center space-y-4",children:[(0,b.jsx)("p",{className:"text-gray-600",children:"Enter this code on your display device to pair it:"}),(0,b.jsx)("div",{className:"bg-gray-100 rounded-lg p-6",children:(0,b.jsx)("div",{className:"text-4xl font-bold text-blue-600 tracking-widest",children:K})}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"This code will expire in 5 minutes"}),(0,b.jsx)("button",{onClick:()=>J(!1),className:"w-full px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition",children:"Done"})]})}),(0,b.jsx)(g.default,{isOpen:G,onClose:()=>H(!1),onConfirm:at,title:"Delete Device",message:`Are you sure you want to delete "${C?.nickname}"? This action cannot be undone.`,confirmText:"Delete",type:"danger"})]})}a.s(["default",()=>t],58894)}];

//# sourceMappingURL=web_src_app_dashboard_devices_page_tsx_e8aef0d9._.js.map